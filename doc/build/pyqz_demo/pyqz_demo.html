

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Running pyqz &mdash; pyqz 0.7.2 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.7.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="pyqz 0.7.2 documentation" href="../index.html" />
    <link rel="next" title="Understanding pyqz" href="../understanding.html" />
    <link rel="prev" title="Installing pyqz" href="../installation.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../understanding.html" title="Understanding pyqz"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../installation.html" title="Installing pyqz"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">pyqz 0.7.2 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="running-pyqz">
<span id="runningpyqz"></span><h1>Running <tt class="docutils literal"><span class="pre">pyqz</span></tt><a class="headerlink" href="#running-pyqz" title="Permalink to this headline">¶</a></h1>
<p>This page is also available as an IPython notebook (<tt class="docutils literal"><span class="pre">pyqz_demo.ipynb</span></tt>)
located in <tt class="docutils literal"><span class="pre">pyqz/examples/</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the code syntax in v0.7.0 has changed significantly, and so did the function calls. <tt class="docutils literal"><span class="pre">pyqz</span> <span class="pre">0.7.x</span></tt> is therefore NOT backward  compatible with older <tt class="docutils literal"><span class="pre">pyqz</span></tt> versions.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">the examples below will show you how to run the main functions inside <tt class="docutils literal"><span class="pre">pyqz</span></tt>. But these do not exempt you from getting acquainted with the &#8220;Understanding <tt class="docutils literal"><span class="pre">pyqz</span></tt>&#8221; section of the documentation !</p>
</div>
<div class="section" id="installing-and-importing-pyqz">
<h2>Installing and importing <tt class="docutils literal"><span class="pre">pyqz</span></tt><a class="headerlink" href="#installing-and-importing-pyqz" title="Permalink to this headline">¶</a></h2>
<p>Installing <tt class="docutils literal"><span class="pre">pyqz</span></tt> is easy. Download it from Github, unpack it anywhere you
like, and make sure that this location is in your Python path. You
should then be able to import the package and check its version from
within any Python shell:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pyqz</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pyqz</span><span class="o">.</span><span class="n">__version__</span>
<span class="go">&#39;0.7.2&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="basic-use-1-accessing-mappings-line-ratio-diagnostic-grids">
<h2>Basic use 1: accessing MAPPINGS line ratio diagnostic grids<a class="headerlink" href="#basic-use-1-accessing-mappings-line-ratio-diagnostic-grids" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">pyqz</span></tt> gives you easy access to the latest MAPPINGS strong line ratio
diagnostic diagrams (and associated info on the MAPPINGS version used to
generate the grid, etc...). This can for example be useful to create
your own line ratio diagnostic plots. You can access the nodes of any
line ratio diagram using <tt class="docutils literal"><span class="pre">pyqz.get_grid()</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a_grid</span> <span class="o">=</span> <span class="n">pyqz</span><span class="o">.</span><span class="n">get_grid</span><span class="p">(</span><span class="s">&#39;[NII]/[SII]+;[OIII]/[SII]+&#39;</span><span class="p">,</span> <span class="n">sampling</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Uncomment the line below for a look at the structure of a_grid</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># a_grid</span>
</pre></div>
</div>
<p>The main parameters of the MAPPINGS simulations can be specified via the
following keywords: - Pk let&#8217;s you define the pressure of the simulated
HII regions, - struct allows you to choose between plane-parallel (&#8216;pp&#8217;)
and spherical (&#8216;sph&#8217;) HII regions, and - kappa lets you define the value
of <span class="math">\(\kappa\)</span> (from the so-called <span class="math">\(\kappa\)</span>-distribution).</p>
<p>All these values must match an existing set of MAPPINGS simulations
inside the <tt class="docutils literal"><span class="pre">pyqz/reference_data/</span></tt> folder, or <tt class="docutils literal"><span class="pre">pyqz</span></tt> will issue an error. In
other words, <tt class="docutils literal"><span class="pre">pyqz</span></tt> will not be running new MAPPINGS simulations for you.</p>
<p>So, if one wanted to access the MAPPINGS simulations for plane-parallel
HII regions, with Maxwell-Boltzmann electron density distribution, <tt class="docutils literal"><span class="pre">Pk</span>
<span class="pre">=5.0</span></tt>, one should type:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a_grid</span> <span class="o">=</span> <span class="n">pyqz</span><span class="o">.</span><span class="n">get_grid</span><span class="p">(</span><span class="s">&#39;[NII]/[SII]+;[OIII]/[SII]+&#39;</span><span class="p">,</span> <span class="n">struct</span> <span class="o">=</span> <span class="s">&#39;pp&#39;</span><span class="p">,</span> <span class="n">Pk</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">=</span> <span class="s">&#39;inf&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Uncomment the line below for a look at the structure of a_grid</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># a_grid</span>
</pre></div>
</div>
<p>If you want to simply check how a given line ratio diagnostic diagram
looks (and e.g. check whether the MAPPINGS grid is flat, or wrapped) for
line ratios of your choice, you can use <tt class="docutils literal"><span class="pre">pyqz.check_grid()</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">bad_segments</span> <span class="o">=</span> <span class="n">pyqz</span><span class="o">.</span><span class="n">check_grid</span><span class="p">(</span><span class="s">&#39;[NII]/[OII]+;[OIII]/[SII]+&#39;</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/output_11_0.png" class="align-center" src="../_images/output_11_0.png" />
<p>An important feature of <tt class="docutils literal"><span class="pre">pyqz</span></tt> is the auto-detection of wraps in the
diagnostic grids, marked with red segments in the diagram, and returned
as an array by the function <tt class="docutils literal"><span class="pre">pyqz.check_grid()</span></tt>.</p>
<p>By default, the default MAPPINGS grids shipped with <tt class="docutils literal"><span class="pre">pyqz</span></tt> are corse. For
various reasons better explained elsewhere (see the MAPPINGS
documentation), only a few abundance values have matching stellar tracks
AND stellar atmospheres. Hence, only a few abundance points can be
simulated in a consistent fashion.</p>
<p>Rather than 1) interpolating between stellar tracks and stellar
atmospheres in the abundance space and 2) running extra MAPPINGS models
(which would use inconsistent &amp; interpolated input), <tt class="docutils literal"><span class="pre">pyqz</span></tt> can directly
resample each diagnostic grid (using the function
<tt class="docutils literal"><span class="pre">pyqz.refine_MVphotogrid()</span></tt>, see the docs for more info). The resampling
is performed in the {<tt class="docutils literal"><span class="pre">LogQ</span></tt> and <tt class="docutils literal"><span class="pre">Tot[O+12]</span></tt> vs line ratio} space for all
line ratios returned by MAPPINGS using Akima splines. Resampled grids
can be accessed via the sampling keyword. Diagnostic grids resampled 2x2
times are shipped in the default <tt class="docutils literal"><span class="pre">pyqz</span></tt> package and are directly
accessible, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">bad_segments</span> <span class="o">=</span> <span class="n">pyqz</span><span class="o">.</span><span class="n">check_grid</span><span class="p">(</span><span class="s">&#39;[NII]/[OII]+;[OIII]/[SII]+&#39;</span><span class="p">,</span><span class="n">show_plot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">sampling</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/output_13_0.png" class="align-center" src="../_images/output_13_0.png" />
<p>In the default <tt class="docutils literal"><span class="pre">pyqz</span></tt> diagrams, the original MAPPINGS nodes are circled
with a black outline, while the reconstructed nodes are not. For grids
more densely resampled, see the &#8220;Advanced use 2&#8221; below.</p>
</div>
<div class="section" id="basic-use-2-deriving-logq-and-tot-o-12-for-a-given-set-of-line-ratios">
<h2>Basic use 2: deriving <tt class="docutils literal"><span class="pre">LogQ</span></tt> and <tt class="docutils literal"><span class="pre">Tot[O+12]</span></tt> for a given set of line ratios<a class="headerlink" href="#basic-use-2-deriving-logq-and-tot-o-12-for-a-given-set-of-line-ratios" title="Permalink to this headline">¶</a></h2>
<p>At the core of <tt class="docutils literal"><span class="pre">pyqz</span></tt> lies <tt class="docutils literal"><span class="pre">pyqz.interp_qz()</span></tt>, which is the basic routine
used to interpolate a given line ratio diagnostic grid. The function is
being fed by line ratios stored inside numpy arrays, and will only
return a value for line ratios landing on valid and un-wrapped regions
of the grid:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">z</span> <span class="o">=</span> <span class="n">pyqz</span><span class="o">.</span><span class="n">interp_qz</span><span class="p">(</span><span class="s">&#39;Tot[O]+12&#39;</span><span class="p">,[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.6</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.1</span><span class="p">])],</span><span class="s">&#39;[NII]/[OII]+;[OIII]/[SII]+&#39;</span><span class="p">,</span> <span class="n">sampling</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">struct</span><span class="o">=</span><span class="s">&#39;pp&#39;</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">z</span>
<span class="go">array([ 8.697449])</span>
</pre></div>
</div>
<img alt="../_images/output_17_0.png" class="align-center" src="../_images/output_17_0.png" />
<p>Of course, one usually wants to compute both <tt class="docutils literal"><span class="pre">LogQ</span></tt> and <tt class="docutils literal"><span class="pre">Tot[O+12]</span></tt> or
<tt class="docutils literal"><span class="pre">gas[O+12]</span></tt> for a large set of strong emission line fluxes, combining the
estimates from different line ratio diagnostics diagrams. This is
exactly what the function <tt class="docutils literal"><span class="pre">pyqz.get_global_qz()</span></tt> allows you to do.</p>
<p>The function is being fed the individual line fluxes and associated
errors in the form of numpy arrays and lists. ID tags for each dataset
can also be given to the function (these are then used if/when saving
the different diagrams to files).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">pyqz</span><span class="o">.</span><span class="n">get_global_qz</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">2.88</span><span class="p">,</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">2.015</span><span class="p">,</span><span class="mf">0.045</span><span class="p">,</span><span class="mf">0.036</span><span class="p">,</span><span class="mf">0.002</span><span class="p">,</span><span class="mf">2.72</span><span class="p">,</span><span class="mf">0.12</span><span class="p">,</span><span class="mf">0.497</span><span class="p">,</span><span class="mf">0.017</span><span class="p">,</span><span class="mf">0.500</span><span class="p">,</span><span class="mf">0.016</span><span class="p">]]),</span>
<span class="go">    [&#39;[OII]+&#39;,&#39;std[OII]+&#39;,&#39;Hb&#39;,&#39;stdHb&#39;,&#39;[OIII]&#39;,&#39;std[OIII]&#39;,&#39;[OI]&#39;,&#39;std[OI]&#39;,&#39;Ha&#39;,&#39;stdHa&#39;,&#39;[NII]&#39;,&#39;std[NII]&#39;,&#39;[SII]+&#39;,&#39;std[SII]+&#39;], [&#39;[NII]/[SII]+;[OIII]/[SII]+&#39;,&#39;[NII]/[OII]+;[OIII]/[OII]+&#39;],</span>
<span class="go">    ids = [&#39;NGC_1234&#39;],</span>
<span class="go">    show_plot=&#39;KDE&#39;, # set this to True to also see the individual line ratio diagrams</span>
<span class="go">    save_plot=True,  # set this to &#39;grids&#39;, &#39;KDE_all&#39;, False or &#39;KDE_flags&#39; (i.e. only the problematic points)</span>
<span class="go">    plot_loc = &#39;./example_plots&#39;,</span>
<span class="go">    struct=&#39;pp&#39;,</span>
<span class="go">    sampling=1)</span>
<span class="go">--&gt; Processing 1 spectrum ...</span>
<span class="go">All done in 0:00:04.370502</span>
<span class="go">[array([[  7.30563675e+00,   8.40752058e+00,   7.58464098e+00,</span>
<span class="go">           8.62834536e+00,   7.44513886e+00,   1.39502113e-01,</span>
<span class="go">           8.51793297e+00,   1.10412390e-01,   7.30007583e+00,</span>
<span class="go">           8.69737797e-03,   8.39739984e+00,   1.69106603e-02,</span>
<span class="go">           7.58765550e+00,   1.58882425e-02,   8.62932458e+00,</span>
<span class="go">           1.19835520e-02,   7.58775759e+00,   3.86829996e-02,</span>
<span class="go">           8.63037803e+00,   3.11968890e-02,   9.24000000e+02,</span>
<span class="go">           0.00000000e+00]]),</span>
<span class="go"> [&#39;[NII]/[SII]+;[OIII]/[SII]+|LogQ&#39;,</span>
<span class="go">  &#39;[NII]/[SII]+;[OIII]/[SII]+|Tot[O]+12&#39;,</span>
<span class="go">  &#39;[NII]/[OII]+;[OIII]/[OII]+|LogQ&#39;,</span>
<span class="go">  &#39;[NII]/[OII]+;[OIII]/[OII]+|Tot[O]+12&#39;,</span>
<span class="go">  &#39;&lt;LogQ&gt;&#39;,</span>
<span class="go">  &#39;std(LogQ)&#39;,</span>
<span class="go">  &#39;&lt;Tot[O]+12&gt;&#39;,</span>
<span class="go">  &#39;std(Tot[O]+12)&#39;,</span>
<span class="go">  &#39;[NII]/[SII]+;[OIII]/[SII]+|LogQ{KDE}&#39;,</span>
<span class="go">  &#39;err([NII]/[SII]+;[OIII]/[SII]+|LogQ{KDE})&#39;,</span>
<span class="go">  &#39;[NII]/[SII]+;[OIII]/[SII]+|Tot[O]+12{KDE}&#39;,</span>
<span class="go">  &#39;err([NII]/[SII]+;[OIII]/[SII]+|Tot[O]+12{KDE})&#39;,</span>
<span class="go">  &#39;[NII]/[OII]+;[OIII]/[OII]+|LogQ{KDE}&#39;,</span>
<span class="go">  &#39;err([NII]/[OII]+;[OIII]/[OII]+|LogQ{KDE})&#39;,</span>
<span class="go">  &#39;[NII]/[OII]+;[OIII]/[OII]+|Tot[O]+12{KDE}&#39;,</span>
<span class="go">  &#39;err([NII]/[OII]+;[OIII]/[OII]+|Tot[O]+12{KDE})&#39;,</span>
<span class="go">  &#39;&lt;LogQ{KDE}&gt;&#39;,</span>
<span class="go">  &#39;err(LogQ{KDE})&#39;,</span>
<span class="go">  &#39;&lt;Tot[O]+12{KDE}&gt;&#39;,</span>
<span class="go">  &#39;err(Tot[O]+12{KDE})&#39;,</span>
<span class="go">  &#39;flag&#39;,</span>
<span class="go">  &#39;rs_offgrid&#39;]]</span>
</pre></div>
</div>
<img alt="../_images/output_19_1.png" class="align-center" src="../_images/output_19_1.png" />
<p>By default, all line fluxes errors are assumed to be gaussian, where the
input std value is the 1 standard deviation. Alternatively, line fluxes
can be tagged as upper-limits by setting their errors to -1.</p>
<p>Users less keen on using Python extensively can alternatively feed their
data to <tt class="docutils literal"><span class="pre">pyqz</span></tt> via an appropriately structured .csv file and receive
another .csv file in return:</p>
<div class="highlight-python"><pre> &gt;&gt;&gt; pyqz.get_global_qz_ff('./example_input.csv',
                       ['[NII]/[SII]+;[OIII]/[SII]+','[NII]/[OII]+;[OIII]/[OII]+'],
                       show_plot='KDE', # set this to True to also see the individual line ratio diagrams
                       save_plot=True,  # set this to 'grids', 'KDE_all', False or 'KDE_flags' (i.e. only the problematic points)
                       plot_loc = './example_plots',
                       struct='pp',
                       sampling=1)
 --&gt; Processing 1 spectrum ...
 All done in 0:00:04.381982
(array([[  7.30563675e+00,   8.40752058e+00,   7.58464098e+00,
            8.62834536e+00,   7.44513886e+00,   1.39502113e-01,
            8.51793297e+00,   1.10412390e-01,   7.30009089e+00,
            9.35766576e-03,   8.39731789e+00,   1.43132660e-02,
            7.57782295e+00,   3.05980853e-02,   8.62299975e+00,
            1.85412415e-02,   7.57794077e+00,   5.03249097e-02,
            8.62192008e+00,   3.87429978e-02,   9.24000000e+02,
            0.00000000e+00]]),
  ['[NII]/[SII]+;[OIII]/[SII]+|LogQ',
   '[NII]/[SII]+;[OIII]/[SII]+|Tot[O]+12',
   '[NII]/[OII]+;[OIII]/[OII]+|LogQ',
   '[NII]/[OII]+;[OIII]/[OII]+|Tot[O]+12',
   '&lt;LogQ&gt;',
   'std(LogQ)',
   '&lt;Tot[O]+12&gt;',
   'std(Tot[O]+12)',
   '[NII]/[SII]+;[OIII]/[SII]+|LogQ{KDE}',
   'err([NII]/[SII]+;[OIII]/[SII]+|LogQ{KDE})',
   '[NII]/[SII]+;[OIII]/[SII]+|Tot[O]+12{KDE}',
   'err([NII]/[SII]+;[OIII]/[SII]+|Tot[O]+12{KDE})',
   '[NII]/[OII]+;[OIII]/[OII]+|LogQ{KDE}',
   'err([NII]/[OII]+;[OIII]/[OII]+|LogQ{KDE})',
   '[NII]/[OII]+;[OIII]/[OII]+|Tot[O]+12{KDE}',
   'err([NII]/[OII]+;[OIII]/[OII]+|Tot[O]+12{KDE})',
   '&lt;LogQ{KDE}&gt;',
   'err(LogQ{KDE})',
   '&lt;Tot[O]+12{KDE}&gt;',
   'err(Tot[O]+12{KDE})',
   'flag',
   'rs_offgrid'])</pre>
</div>
<img alt="../_images/output_22_1.png" class="align-center" src="../_images/output_22_1.png" />
<p>The first line of the input file must contain the name of each column,
following the <tt class="docutils literal"><span class="pre">pyqz</span></tt> convention. The order itself does not matter, e.g.:</p>
<div class="highlight-python"><pre>Id,[OII]+,std[OII]+,Hb,stdHb,[OIII],std[OIII],[OI],std[OI],Ha,stdHa,[NII],std[NII],[SII]+,std[SII]+</pre>
</div>
<p>The Id (optional) can be used to add a tag (i.e. a string) to each set
of line fluxes. This tag will be used in the filenames of the diagrams
(if some are saved) and in the output <tt class="docutils literal"><span class="pre">.csv</span></tt> file as well.</p>
<p>Commented line begin with #, missing values are marked with
<span class="math">\($\)</span> (set with the missing_values keyword), and the decimal
precison in the output file is set with decimals (default=5).</p>
<p>At this point, it must be stressed that <tt class="docutils literal"><span class="pre">pyqz.get_global_qz()</span></tt> only
exploit a finite set of diagnostic grids, namely:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">pyqz</span><span class="o">.</span><span class="n">diagnostics</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">[&#39;[NII]/[OII]+;[OIII]/[SII]+&#39;,</span>
<span class="go"> &#39;[NII]/Ha;[OIII]/Hb&#39;,</span>
<span class="go"> &#39;[NII]/[OII]+;[OIII]/[OII]+&#39;,</span>
<span class="go"> &#39;[NII]/[SII]+;[OIII]/Hb&#39;,</span>
<span class="go"> &#39;[NII]/[SII]+;[OIII]/[OII]+&#39;,</span>
<span class="go"> &#39;[NII]/[SII]+;[NII]/Ha;[OIII]/Hb&#39;,</span>
<span class="go"> &#39;[NII]/[OII]+;[OIII]/Hb&#39;,</span>
<span class="go"> &#39;[NII]/Ha;[OIII]/[OII]+&#39;,</span>
<span class="go"> &#39;[NII]/[SII]+;[OIII]/[SII]+&#39;]</span>
</pre></div>
</div>
<p>These specific diagnostic diagrams are chosen to be largely flat, i.e.
they are able to cleanly disentangle the influence of <tt class="docutils literal"><span class="pre">LogQ</span></tt> and
<tt class="docutils literal"><span class="pre">Tot[O]+12</span></tt>. One does not need to use all the grids together. For example,
if one knows that an [OII] line flux measurement is corrupted, one ought
to simply use the diagnostic grids that do not rely on this line to
derive the estimates of <tt class="docutils literal"><span class="pre">LogQ</span></tt> and <tt class="docutils literal"><span class="pre">Tot[O]+12</span></tt>.</p>
<p>Users can easily add new diagnostics to this list (defined inside
<tt class="docutils literal"><span class="pre">pyqz_metadata.py</span></tt>), but will do so at their own risk.</p>
</div>
<div class="section" id="advanced-use-1-using-custom-mappings-grids">
<h2>Advanced use 1: using custom MAPPINGS grids<a class="headerlink" href="#advanced-use-1-using-custom-mappings-grids" title="Permalink to this headline">¶</a></h2>
<p>While <tt class="docutils literal"><span class="pre">pyqz</span></tt> ships with a default set of HII region simulations from
MAPPINGS, some (all!) users might be interested in using <tt class="docutils literal"><span class="pre">pyqz</span></tt> with their
own specific sets of MAPPINGS simulations. <tt class="docutils literal"><span class="pre">pyqz</span></tt> was designed to be
compatible with the grids generated from the awk script provided
alongside MAPPINGS.</p>
<p>If one uses the awk script to create new MAPPINGS grids, the resulting
.csv file must be laced inside <tt class="docutils literal"><span class="pre">pyqz/reference_data</span></tt>. The filename must
match what the function <tt class="docutils literal"><span class="pre">pyqz.get_MVphotogrid_fn()</span></tt> expects for your
given set of parameters:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">pyqz</span><span class="o">.</span><span class="n">get_MVphotogrid_fn</span><span class="p">(</span><span class="n">Pk</span><span class="o">=</span><span class="mf">6.7</span><span class="p">,</span><span class="n">calibs</span><span class="o">=</span><span class="s">&#39;GCZO&#39;</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">struct</span><span class="o">=</span><span class="s">&#39;pp&#39;</span><span class="p">)</span>
<span class="go">&#39;/Users/fvogt/Tools/Python/fpav_pylib/pyqz/pyqz_dev/reference_data/grid_QZ_pp_GCZO_Pk67_k10.csv&#39;</span>
</pre></div>
</div>
<p>If one does not use the awk script to generate the custom MAPPINGS grid,
then just make sure your model grid matches the format of existing model
grids located in <tt class="docutils literal"><span class="pre">pyqz/reference_data/</span></tt> ...</p>
</div>
<div class="section" id="advanced-usage-2-resampling-the-original-mappings-grids">
<h2>Advanced usage 2: resampling the original MAPPINGS grids<a class="headerlink" href="#advanced-usage-2-resampling-the-original-mappings-grids" title="Permalink to this headline">¶</a></h2>
<p>By default, 2 times resampled MAPPINGS grid are shipped with <tt class="docutils literal"><span class="pre">pyqz</span></tt>. These
are generated using the function <tt class="docutils literal"><span class="pre">pyqz.resample_MVphotogrid()</span></tt>, which is
straightforward to use:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">grid_fn</span> <span class="o">=</span> <span class="n">pyqz</span><span class="o">.</span><span class="n">get_MVphotogrid_fn</span><span class="p">(</span><span class="n">Pk</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span><span class="n">struct</span><span class="o">=</span><span class="s">&#39;sph&#39;</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pyqz</span><span class="o">.</span><span class="n">resample_MVphotogrid</span><span class="p">(</span><span class="n">grid_fn</span><span class="p">,</span> <span class="n">sampling</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="go">Success: grid_QZ_sph_GCZO_Pk50_kinf.csv resampled by a factor 2x2 and saved as grid_QZ_sph_GCZO_Pk50_kinf_samp_2.csv</span>
</pre></div>
</div>
<p>More densely resampled grids can then easily be created by varying the
sampling keyword.</p>
</div>
<div class="section" id="advanced-usage-3-3-d-line-ratio-diagrams">
<h2>Advanced usage 3: &#8220;3-D&#8221; line ratio diagrams<a class="headerlink" href="#advanced-usage-3-3-d-line-ratio-diagrams" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">pyqz</span></tt> does support 2-D line ratio diagrams constructed from 3 sets of
line ratios (i.e. 3-D line ratio diagrams projected to a given 2-D
plane):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">bad_segments</span> <span class="o">=</span> <span class="n">pyqz</span><span class="o">.</span><span class="n">check_grid</span><span class="p">(</span><span class="s">&#39;[NII]/[SII]+;[NII]/Ha;[OIII]/Hb&#39;</span><span class="p">,</span>
<span class="go">                coeffs = [[1.0,0.264,0.0],[0.242,-0.910,0.342]],</span>
<span class="go">                show_plot=True,</span>
<span class="go">                struct=&#39;sph&#39;,</span>
<span class="go">                sampling=1)</span>
</pre></div>
</div>
<img alt="../_images/output_37_0.png" class="align-center" src="../_images/output_37_0.png" />
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installing <tt class="docutils literal"><span class="pre">pyqz</span></tt></a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Running <tt class="docutils literal"><span class="pre">pyqz</span></tt></a></li>
<li class="toctree-l1"><a class="reference internal" href="../understanding.html">Understanding <tt class="docutils literal"><span class="pre">pyqz</span></tt></a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions.html">The functions of <tt class="docutils literal"><span class="pre">pyqz</span></tt></a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../installation.html"
                        title="previous chapter">Installing <tt class="docutils literal docutils literal docutils literal"><span class="pre">pyqz</span></tt></a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../understanding.html"
                        title="next chapter">Understanding <tt class="docutils literal docutils literal"><span class="pre">pyqz</span></tt></a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../understanding.html" title="Understanding pyqz"
             >next</a> |</li>
        <li class="right" >
          <a href="../installation.html" title="Installing pyqz"
             >previous</a> |</li>
        <li><a href="../index.html">pyqz 0.7.2 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Frédéric Vogt.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>