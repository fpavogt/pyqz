

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Running pyqz I &mdash; pyqz 0.8.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="pyqz 0.8.1 documentation" href="../index.html"/>
        <link rel="next" title="Running pyqz II" href="../pyqz_demo_advanced/pyqz_demo_advanced.html"/>
        <link rel="prev" title="Installing pyqz" href="../installation.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> pyqz
          

          
            
            <img src="../_static/pyqz.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                0.8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installing pyqz</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Running pyqz I</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#a-installing-and-importing-pyqz">A) Installing and importing pyqz</a></li>
<li class="toctree-l2"><a class="reference internal" href="#b-accessing-mappings-line-ratio-diagnostic-grids">B) Accessing MAPPINGS line ratio diagnostic grids</a></li>
<li class="toctree-l2"><a class="reference internal" href="#c-deriving-logq-and-tot-o-12-for-a-given-set-of-line-ratios">C) Deriving LogQ and Tot[O+12] for a given set of line ratios</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pyqz_demo_advanced/pyqz_demo_advanced.html">Running pyqz II</a></li>
<li class="toctree-l1"><a class="reference internal" href="../understanding.html">Understanding pyqz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyqz_demo_param/pyqz_demo_param.html">The parameters of pyqz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/modules.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledge.html">Acknowledging pyqz</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">pyqz</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>Running pyqz I</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/pyqz_demo_basic/pyqz_demo_basic.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="running-pyqz-i">
<span id="runningpyqzbasic"></span><h1>Running pyqz I<a class="headerlink" href="#running-pyqz-i" title="Permalink to this headline">¶</a></h1>
<p>This page is also available as an IPython notebook
(<code class="docutils literal"><span class="pre">pyqz_demo_basic.ipynb</span></code>) included with the code and located in
<code class="docutils literal"><span class="pre">pyqz/examples/</span></code>.</p>
<div class="section" id="a-installing-and-importing-pyqz">
<h2>A) Installing and importing pyqz<a class="headerlink" href="#a-installing-and-importing-pyqz" title="Permalink to this headline">¶</a></h2>
<p>Installing pyqz is easy. Download it from Github, unpack it anywhere you
like, and make sure that this location is in your Python path. You
should then be able to import the package and check its version from
within any Python shell:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span> <span class="nn">pyqz</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
<p>From v0.8.0 onwards, the plotting functions have been separated in a
distinct module, which must be import separately, if you wish to exploit
them.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyqz_plots</span>
</pre></div>
</div>
</div>
<div class="section" id="b-accessing-mappings-line-ratio-diagnostic-grids">
<h2>B) Accessing MAPPINGS line ratio diagnostic grids<a class="headerlink" href="#b-accessing-mappings-line-ratio-diagnostic-grids" title="Permalink to this headline">¶</a></h2>
<p>pyqz gives you easy access to the latest MAPPINGS strong nebular line
ratio diagnostic diagrams (and associated info on the MAPPINGS version
used to generate the grid, etc...). This can for example be useful to
create your own line ratio diagnostic plots. You can access the nodes of
any line ratio diagram using <code class="docutils literal"><span class="pre">pyqz.get_grid()</span></code>:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">a_grid</span> <span class="o">=</span> <span class="n">pyqz</span><span class="o">.</span><span class="n">get_grid</span><span class="p">(</span><span class="s1">&#39;[NII]/[SII]+;[OIII]/[SII]+&#39;</span><span class="p">,</span> <span class="n">sampling</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>The main parameters of the MAPPINGS simulations can be specified via the
following keywords:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">Pk</span></code> let&#8217;s you define the pressure of the simulated HII regions,</li>
<li><code class="docutils literal"><span class="pre">struct</span></code> allows you to choose between plane-parallel (<code class="docutils literal"><span class="pre">'pp'</span></code>) and spherical (<code class="docutils literal"><span class="pre">'sph'</span></code>) HII regions, and</li>
<li><code class="docutils literal"><span class="pre">kappa</span></code> lets you define the value of <span class="math">\(\kappa\)</span> (from the so-called <span class="math">\(\kappa\)</span>-distribution).</li>
</ul>
</div></blockquote>
<p>All these values must match an existing set of MAPPINGS simulations
inside the <code class="docutils literal"><span class="pre">pyqz/reference_data/</span></code> folder, or pyqz will issue an error.
In other words, pyqz will not be running new MAPPINGS simulations for
you.</p>
<p>So, if one wanted to access the MAPPINGS simulations for plane-parallel
HII regions, with Maxwell-Boltzmann electron density distribution,
<code class="docutils literal"><span class="pre">Pk</span> <span class="pre">=</span> <span class="pre">5.0</span></code> (these are the default parameters), one should type:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">a_grid</span> <span class="o">=</span> <span class="n">pyqz</span><span class="o">.</span><span class="n">get_grid</span><span class="p">(</span><span class="s1">&#39;[NII]/[SII]+;[OIII]/[SII]+&#39;</span><span class="p">,</span> <span class="n">struct</span> <span class="o">=</span> <span class="s1">&#39;pp&#39;</span><span class="p">,</span> <span class="n">Pk</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">=</span> <span class="s1">&#39;inf&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you want to check how a given line ratio diagnostic diagram looks
(and e.g. check whether the MAPPINGS grid is flat, or wrapped) for line
ratios of your choice, you can use <code class="docutils literal"><span class="pre">pyqz_plots.plot_grid()</span></code>:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">pyqz_plots</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="s1">&#39;[NII]/[OII]+;[OIII]/[OII]+&#39;</span><span class="p">,</span> <span class="n">struct</span> <span class="o">=</span> <span class="s1">&#39;pp&#39;</span><span class="p">,</span> <span class="n">Pk</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">=</span> <span class="s1">&#39;inf&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/output_13_01.png" src="../_images/output_13_01.png" />
<p>You can check which version of MAPPINGS was used to generate the grids
currently inside pyqz as follows:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">fn</span> <span class="o">=</span> <span class="n">pyqz</span><span class="o">.</span><span class="n">pyqz_tools</span><span class="o">.</span><span class="n">get_MVphotogrid_fn</span><span class="p">(</span><span class="n">Pk</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">calibs</span> <span class="o">=</span> <span class="s1">&#39;GCZO&#39;</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">struct</span> <span class="o">=</span> <span class="s1">&#39;pp&#39;</span><span class="p">,</span> <span class="n">sampling</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">info</span> <span class="o">=</span> <span class="n">pyqz</span><span class="o">.</span><span class="n">pyqz_tools</span><span class="o">.</span><span class="n">get_MVphotogrid_metadata</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

<span class="nb">print</span> <span class="s1">&#39;MAPPINGS id: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;MV_id&#39;</span><span class="p">]</span>
<span class="nb">print</span> <span class="s1">&#39;Model created: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span>
<span class="nb">print</span> <span class="s1">&#39;Model parameters: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MAPPINGS</span> <span class="nb">id</span><span class="p">:</span> <span class="n">MAPPINGS</span> <span class="n">V</span> <span class="n">HII</span> <span class="n">Region</span> <span class="n">Grid</span><span class="p">:</span> <span class="n">QZ</span> <span class="n">pp_GCZO_Pk50_kinf</span>
<span class="n">Model</span> <span class="n">created</span><span class="p">:</span> <span class="n">Thu</span> <span class="n">Dec</span> <span class="mi">10</span> <span class="mi">14</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">36</span> <span class="n">CLST</span> <span class="mi">2015</span>
<span class="n">Model</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">pp</span><span class="p">,</span><span class="n">two</span><span class="p">,</span><span class="n">LPk</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span><span class="n">dep</span><span class="o">=</span><span class="n">Depln_Fe_1</span><span class="o">.</span><span class="mf">50.</span><span class="n">txt</span><span class="p">,</span><span class="n">kap</span><span class="o">=</span><span class="n">inf</span><span class="p">,</span><span class="n">GCZFea05t2</span><span class="p">,</span><span class="n">SF</span><span class="o">=</span><span class="n">cont</span><span class="p">,</span><span class="n">a05</span><span class="p">,</span><span class="n">isp</span><span class="p">,</span><span class="c1">#11,P6,Mv5.0.16,Svm802,FE15</span>
</pre></div>
</div>
<p>An important feature of pyqz is the auto-detection of wraps in the
diagnostic grids, marked with red segments in the diagram, and returned
as an array by the function <code class="docutils literal"><span class="pre">pyqz.check_grid()</span></code>.</p>
<p>The default MAPPINGS grids shipped with pyqz are coarse. For various
reasons better explained elsewhere (see the MAPPINGS documentation),
only a few abundance values have matching stellar tracks AND stellar
atmospheres. Hence, only a few abundance points can be simulated in a
consistent fashion.</p>
<p>Rather than 1) interpolating between stellar tracks and stellar
atmospheres in the abundance space and 2) running extra MAPPINGS models
(which would use inconsistent &amp; interpolated input), pyqz can directly
resample each diagnostic grid (using the function
<code class="docutils literal"><span class="pre">pyqz_tools.refine_MVphotogrid()</span></code>, see the docs for more info). The
resampling is performed in the {<code class="docutils literal"><span class="pre">LogQ</span></code> and <code class="docutils literal"><span class="pre">Tot[O+12]</span></code> vs line
ratio} space for all line ratios returned by MAPPINGS using Akima
splines. Resampled grids can be accessed via the <code class="docutils literal"><span class="pre">sampling</span></code> keyword.
Diagnostic grids resampled 2x2 times are shipped in the default pyqz
package and are directly accessible, e.g.:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">pyqz_plots</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="s1">&#39;[NII]/[OII]+;[OIII]/[OII]+&#39;</span><span class="p">,</span> <span class="n">struct</span> <span class="o">=</span> <span class="s1">&#39;pp&#39;</span><span class="p">,</span> <span class="n">Pk</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">=</span> <span class="s1">&#39;inf&#39;</span><span class="p">,</span> <span class="n">sampling</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/output_17_0.png" src="../_images/output_17_0.png" />
<p>In the default pyqz diagrams, the original MAPPINGS nodes are circled
with a black outline, while the reconstructed nodes are not. For grids
more densely resampled, see the &#8220;Advanced use 2&#8221; below.</p>
</div>
<div class="section" id="c-deriving-logq-and-tot-o-12-for-a-given-set-of-line-ratios">
<h2>C) Deriving LogQ and Tot[O+12] for a given set of line ratios<a class="headerlink" href="#c-deriving-logq-and-tot-o-12-for-a-given-set-of-line-ratios" title="Permalink to this headline">¶</a></h2>
<p>At the core of pyqz lies <code class="docutils literal"><span class="pre">pyqz.interp_qz()</span></code>, which is the basic
routine used to interpolate a given line ratio diagnostic grid. The
function is being fed by line ratios stored inside numpy arrays, and
will only return a value for line ratios landing on valid and un-wrapped
regions of the grid:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">niioii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.65</span><span class="p">])</span>
<span class="n">oiiisii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.1</span><span class="p">])</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">pyqz</span><span class="o">.</span><span class="n">interp_qz</span><span class="p">(</span><span class="s1">&#39;Tot[O]+12&#39;</span><span class="p">,[</span><span class="n">niioii</span><span class="p">,</span> <span class="n">oiiisii</span><span class="p">],</span><span class="s1">&#39;[NII]/[OII]+;[OIII]/[SII]+&#39;</span><span class="p">,</span>
                   <span class="n">sampling</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">struct</span><span class="o">=</span><span class="s1">&#39;pp&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="s1">&#39;Tot[O]+12 = </span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">z</span>

<span class="c1"># The result can be visualized using pyqz_plots.plot_grid()</span>
<span class="n">pyqz_plots</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="s1">&#39;[NII]/[OII]+;[OIII]/[SII]+&#39;</span><span class="p">,</span><span class="n">sampling</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">struct</span><span class="o">=</span><span class="s1">&#39;pp&#39;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">niioii</span><span class="p">,</span><span class="n">oiiisii</span><span class="p">],</span> <span class="n">interp_data</span><span class="o">=</span><span class="n">z</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Tot</span><span class="p">[</span><span class="n">O</span><span class="p">]</span><span class="o">+</span><span class="mi">12</span> <span class="o">=</span> <span class="mf">8.67</span>
</pre></div>
</div>
<img alt="../_images/output_21_1.png" src="../_images/output_21_1.png" />
<p>Of course, one usually wants to compute both <code class="docutils literal"><span class="pre">LogQ</span></code> and
<code class="docutils literal"><span class="pre">Tot[O+12]</span></code>or <code class="docutils literal"><span class="pre">gas[O+12]</span></code> for a large set of strong emission line
fluxes, combining the estimates from different line ratio diagnostics
diagrams. This is exactly what the function <code class="docutils literal"><span class="pre">pyqz.get_global_qz()</span></code>
allows you to do.</p>
<p>The function is being fed the individual line fluxes and associated
errors in the form of numpy arrays and lists. ID tags for each dataset
can also be given to the function (these are then used if/when saving
the different diagrams to files).</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">pyqz</span><span class="o">.</span><span class="n">get_global_qz</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="mf">1.00e+00</span><span class="p">,</span> <span class="mf">5.00e-02</span><span class="p">,</span> <span class="mf">2.38e+00</span><span class="p">,</span> <span class="mf">1.19e-01</span><span class="p">,</span> <span class="mf">5.07e+00</span><span class="p">,</span> <span class="mf">2.53e-01</span><span class="p">,</span>
                               <span class="mf">5.67e-01</span><span class="p">,</span> <span class="mf">2.84e-02</span><span class="p">,</span> <span class="mf">5.11e-01</span><span class="p">,</span> <span class="mf">2.55e-02</span><span class="p">,</span> <span class="mf">2.88e+00</span><span class="p">,</span> <span class="mf">1.44e-01</span><span class="p">]]),</span>
                   <span class="p">[</span><span class="s1">&#39;Hb&#39;</span><span class="p">,</span><span class="s1">&#39;stdHb&#39;</span><span class="p">,</span><span class="s1">&#39;[OIII]&#39;</span><span class="p">,</span><span class="s1">&#39;std[OIII]&#39;</span><span class="p">,</span><span class="s1">&#39;[OII]+&#39;</span><span class="p">,</span><span class="s1">&#39;std[OII]+&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;[NII]&#39;</span><span class="p">,</span><span class="s1">&#39;std[NII]&#39;</span><span class="p">,</span><span class="s1">&#39;[SII]+&#39;</span><span class="p">,</span><span class="s1">&#39;std[SII]+&#39;</span><span class="p">,</span><span class="s1">&#39;Ha&#39;</span><span class="p">,</span><span class="s1">&#39;stdHa&#39;</span><span class="p">],</span>
                   <span class="p">[</span><span class="s1">&#39;[NII]/[SII]+;[OIII]/Hb&#39;</span><span class="p">,</span><span class="s1">&#39;[NII]/[OII]+;[OIII]/[SII]+&#39;</span><span class="p">],</span>
                   <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NGC_1234&#39;</span><span class="p">],</span>
                   <span class="n">KDE_method</span> <span class="o">=</span> <span class="s1">&#39;multiv&#39;</span><span class="p">,</span>
                   <span class="n">KDE_qz_sampling</span> <span class="o">=</span> <span class="mi">201</span><span class="n">j</span><span class="p">,</span>
                   <span class="n">struct</span> <span class="o">=</span> <span class="s1">&#39;pp&#39;</span><span class="p">,</span>
                   <span class="n">sampling</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                   <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>--&gt; Received 1 spectrum ...
--&gt; Dealing with them one at a time ... be patient now !
    (no status update until I am done ...)

All done in 0:00:00.570925
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">array</span><span class="p">([[</span>  <span class="mf">7.38831887e+00</span><span class="p">,</span>   <span class="mf">8.48760006e+00</span><span class="p">,</span>   <span class="mf">7.37681443e+00</span><span class="p">,</span>
           <span class="mf">8.48372388e+00</span><span class="p">,</span>   <span class="mf">7.38256665e+00</span><span class="p">,</span>   <span class="mf">5.75221877e-03</span><span class="p">,</span>
           <span class="mf">8.48566197e+00</span><span class="p">,</span>   <span class="mf">1.93808636e-03</span><span class="p">,</span>   <span class="mf">7.40187112e+00</span><span class="p">,</span>
           <span class="mf">5.25153395e-02</span><span class="p">,</span>   <span class="mf">8.48403665e+00</span><span class="p">,</span>   <span class="mf">5.81923212e-02</span><span class="p">,</span>
           <span class="mf">7.38004469e+00</span><span class="p">,</span>   <span class="mf">2.91962544e-02</span><span class="p">,</span>   <span class="mf">8.48364792e+00</span><span class="p">,</span>
           <span class="mf">2.74853806e-02</span><span class="p">,</span>   <span class="mf">7.38278851e+00</span><span class="p">,</span>   <span class="mf">3.35428824e-02</span><span class="p">,</span>
           <span class="mf">8.48207392e+00</span><span class="p">,</span>   <span class="mf">3.32925610e-02</span><span class="p">,</span>   <span class="mf">0.00000000e+00</span><span class="p">,</span>
           <span class="mf">0.00000000e+00</span><span class="p">]]),</span>
 <span class="p">[</span><span class="s1">&#39;[NII]/[SII]+;[OIII]/Hb|LogQ&#39;</span><span class="p">,</span>
  <span class="s1">&#39;[NII]/[SII]+;[OIII]/Hb|Tot[O]+12&#39;</span><span class="p">,</span>
  <span class="s1">&#39;[NII]/[OII]+;[OIII]/[SII]+|LogQ&#39;</span><span class="p">,</span>
  <span class="s1">&#39;[NII]/[OII]+;[OIII]/[SII]+|Tot[O]+12&#39;</span><span class="p">,</span>
  <span class="s1">&#39;&lt;LogQ&gt;&#39;</span><span class="p">,</span>
  <span class="s1">&#39;std(LogQ)&#39;</span><span class="p">,</span>
  <span class="s1">&#39;&lt;Tot[O]+12&gt;&#39;</span><span class="p">,</span>
  <span class="s1">&#39;std(Tot[O]+12)&#39;</span><span class="p">,</span>
  <span class="s1">&#39;[NII]/[SII]+;[OIII]/Hb|LogQ</span><span class="si">{KDE}</span><span class="s1">&#39;</span><span class="p">,</span>
  <span class="s1">&#39;err([NII]/[SII]+;[OIII]/Hb|LogQ</span><span class="si">{KDE}</span><span class="s1">)&#39;</span><span class="p">,</span>
  <span class="s1">&#39;[NII]/[SII]+;[OIII]/Hb|Tot[O]+12</span><span class="si">{KDE}</span><span class="s1">&#39;</span><span class="p">,</span>
  <span class="s1">&#39;err([NII]/[SII]+;[OIII]/Hb|Tot[O]+12</span><span class="si">{KDE}</span><span class="s1">)&#39;</span><span class="p">,</span>
  <span class="s1">&#39;[NII]/[OII]+;[OIII]/[SII]+|LogQ</span><span class="si">{KDE}</span><span class="s1">&#39;</span><span class="p">,</span>
  <span class="s1">&#39;err([NII]/[OII]+;[OIII]/[SII]+|LogQ</span><span class="si">{KDE}</span><span class="s1">)&#39;</span><span class="p">,</span>
  <span class="s1">&#39;[NII]/[OII]+;[OIII]/[SII]+|Tot[O]+12</span><span class="si">{KDE}</span><span class="s1">&#39;</span><span class="p">,</span>
  <span class="s1">&#39;err([NII]/[OII]+;[OIII]/[SII]+|Tot[O]+12</span><span class="si">{KDE}</span><span class="s1">)&#39;</span><span class="p">,</span>
  <span class="s1">&#39;&lt;LogQ</span><span class="si">{KDE}</span><span class="s1">&gt;&#39;</span><span class="p">,</span>
  <span class="s1">&#39;err(LogQ</span><span class="si">{KDE}</span><span class="s1">)&#39;</span><span class="p">,</span>
  <span class="s1">&#39;&lt;Tot[O]+12</span><span class="si">{KDE}</span><span class="s1">&gt;&#39;</span><span class="p">,</span>
  <span class="s1">&#39;err(Tot[O]+12</span><span class="si">{KDE}</span><span class="s1">)&#39;</span><span class="p">,</span>
  <span class="s1">&#39;flag&#39;</span><span class="p">,</span>
  <span class="s1">&#39;rs_offgrid&#39;</span><span class="p">]]</span>
</pre></div>
</div>
<p>By default, all line fluxes errors are assumed to be gaussian, where the
input <code class="docutils literal"><span class="pre">std</span></code> value is the 1 standard deviation. Alternatively, line
fluxes can be tagged as upper-limits by setting their errors to -1.</p>
<p>The outcome of <code class="docutils literal"><span class="pre">get_global_qz()</span></code> can be visualized using
<code class="docutils literal"><span class="pre">pyqz_plots.plot_global_qz()</span></code>, but only if <code class="docutils literal"><span class="pre">KDE_pickle_loc</span></code> is set
in the first one. This keyword defines the location in which to save a
<code class="docutils literal"><span class="pre">pickle</span></code> file that contains all the relevant pieces of information
associated with a given function call, i.e.: the single and global KDE,
the <code class="docutils literal"><span class="pre">srs</span></code> random realizations of the line fluxes, etc ...</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">out</span> <span class="o">=</span> <span class="n">pyqz</span><span class="o">.</span><span class="n">get_global_qz</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="mf">1.00e+00</span><span class="p">,</span> <span class="mf">5.00e-02</span><span class="p">,</span> <span class="mf">2.38e+00</span><span class="p">,</span> <span class="mf">1.19e-01</span><span class="p">,</span> <span class="mf">5.07e+00</span><span class="p">,</span> <span class="mf">2.53e-01</span><span class="p">,</span>
                                     <span class="mf">5.67e-01</span><span class="p">,</span> <span class="mf">2.84e-02</span><span class="p">,</span> <span class="mf">5.11e-01</span><span class="p">,</span> <span class="mf">2.55e-02</span><span class="p">,</span> <span class="mf">2.88e+00</span><span class="p">,</span> <span class="mf">1.44e-01</span><span class="p">]]),</span>
                   <span class="p">[</span><span class="s1">&#39;Hb&#39;</span><span class="p">,</span><span class="s1">&#39;stdHb&#39;</span><span class="p">,</span><span class="s1">&#39;[OIII]&#39;</span><span class="p">,</span><span class="s1">&#39;std[OIII]&#39;</span><span class="p">,</span><span class="s1">&#39;[OII]+&#39;</span><span class="p">,</span><span class="s1">&#39;std[OII]+&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;[NII]&#39;</span><span class="p">,</span><span class="s1">&#39;std[NII]&#39;</span><span class="p">,</span><span class="s1">&#39;[SII]+&#39;</span><span class="p">,</span><span class="s1">&#39;std[SII]+&#39;</span><span class="p">,</span><span class="s1">&#39;Ha&#39;</span><span class="p">,</span><span class="s1">&#39;stdHa&#39;</span><span class="p">],</span>
                   <span class="p">[</span><span class="s1">&#39;[NII]/[SII]+;[OIII]/Hb&#39;</span><span class="p">,</span><span class="s1">&#39;[NII]/[OII]+;[OIII]/[SII]+&#39;</span><span class="p">],</span>
                   <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NGC_1234&#39;</span><span class="p">],</span>
                   <span class="n">KDE_method</span> <span class="o">=</span> <span class="s1">&#39;multiv&#39;</span><span class="p">,</span>
                   <span class="n">KDE_qz_sampling</span> <span class="o">=</span> <span class="mi">201</span><span class="n">j</span><span class="p">,</span>
                   <span class="n">KDE_pickle_loc</span> <span class="o">=</span> <span class="s1">&#39;./example_plots/&#39;</span><span class="p">,</span>
                   <span class="n">struct</span> <span class="o">=</span> <span class="s1">&#39;pp&#39;</span><span class="p">,</span>
                   <span class="n">sampling</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                   <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">glob</span>
<span class="n">fn</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;./example_plots/*NGC_1234*.pkl&#39;</span><span class="p">)</span>

<span class="c1"># pyqz_plots.get_global_qz() takes the pickle filename as argument.</span>
<span class="n">pyqz_plots</span><span class="o">.</span><span class="n">plot_global_qz</span><span class="p">(</span><span class="n">fn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">show_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_loc</span> <span class="o">=</span> <span class="s1">&#39;./example_plots&#39;</span><span class="p">,</span> <span class="n">do_all_diags</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>--&gt; Received 1 spectrum ...
--&gt; Dealing with them one at a time ... be patient now !
    (no status update until I am done ...)

All done in 0:00:00.639897
</pre></div>
</div>
<img alt="../_images/output_25_1.png" src="../_images/output_25_1.png" />
<img alt="../_images/output_25_2.png" src="../_images/output_25_2.png" />
<img alt="../_images/output_25_3.png" src="../_images/output_25_3.png" />
<img alt="../_images/output_25_4.png" src="../_images/output_25_4.png" />
<img alt="../_images/output_25_5.png" src="../_images/output_25_5.png" />
<p>Users less keen on using Python extensively can alternatively feed their
data to pyqz via an appropriately structured <code class="docutils literal"><span class="pre">.csv</span></code> file and receive
another <code class="docutils literal"><span class="pre">.csv</span></code> file in return (as well as a numpy array):</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">pyqz</span><span class="o">.</span><span class="n">get_global_qz_ff</span><span class="p">(</span><span class="s1">&#39;./example_input.csv&#39;</span><span class="p">,</span>
                      <span class="p">[</span><span class="s1">&#39;[NII]/[SII]+;[OIII]/Hb&#39;</span><span class="p">,</span><span class="s1">&#39;[NII]/[OII]+;[OIII]/[SII]+&#39;</span><span class="p">],</span>
                      <span class="n">struct</span><span class="o">=</span><span class="s1">&#39;pp&#39;</span><span class="p">,</span>
                      <span class="n">KDE_method</span><span class="o">=</span><span class="s1">&#39;multiv&#39;</span><span class="p">,</span>
                      <span class="n">KDE_qz_sampling</span> <span class="o">=</span> <span class="mi">201</span><span class="n">j</span><span class="p">,</span>
                      <span class="n">sampling</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>--&gt; Received 1 spectrum ...
--&gt; Dealing with them one at a time ... be patient now !
    (no status update until I am done ...)

All done in 0:00:00.521950
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">array</span><span class="p">([[</span>  <span class="mf">7.38831887e+00</span><span class="p">,</span>   <span class="mf">8.48760006e+00</span><span class="p">,</span>   <span class="mf">7.37681443e+00</span><span class="p">,</span>
           <span class="mf">8.48372388e+00</span><span class="p">,</span>   <span class="mf">7.38256665e+00</span><span class="p">,</span>   <span class="mf">5.75221877e-03</span><span class="p">,</span>
           <span class="mf">8.48566197e+00</span><span class="p">,</span>   <span class="mf">1.93808636e-03</span><span class="p">,</span>   <span class="mf">7.40830999e+00</span><span class="p">,</span>
           <span class="mf">5.96592780e-02</span><span class="p">,</span>   <span class="mf">8.49102382e+00</span><span class="p">,</span>   <span class="mf">5.97711699e-02</span><span class="p">,</span>
           <span class="mf">7.38561173e+00</span><span class="p">,</span>   <span class="mf">2.66149396e-02</span><span class="p">,</span>   <span class="mf">8.48676873e+00</span><span class="p">,</span>
           <span class="mf">2.35291434e-02</span><span class="p">,</span>   <span class="mf">7.38608041e+00</span><span class="p">,</span>   <span class="mf">3.38911741e-02</span><span class="p">,</span>
           <span class="mf">8.48524692e+00</span><span class="p">,</span>   <span class="mf">3.24784930e-02</span><span class="p">,</span>   <span class="mf">0.00000000e+00</span><span class="p">,</span>
           <span class="mf">0.00000000e+00</span><span class="p">]]),</span>
 <span class="p">[</span><span class="s1">&#39;[NII]/[SII]+;[OIII]/Hb|LogQ&#39;</span><span class="p">,</span>
  <span class="s1">&#39;[NII]/[SII]+;[OIII]/Hb|Tot[O]+12&#39;</span><span class="p">,</span>
  <span class="s1">&#39;[NII]/[OII]+;[OIII]/[SII]+|LogQ&#39;</span><span class="p">,</span>
  <span class="s1">&#39;[NII]/[OII]+;[OIII]/[SII]+|Tot[O]+12&#39;</span><span class="p">,</span>
  <span class="s1">&#39;&lt;LogQ&gt;&#39;</span><span class="p">,</span>
  <span class="s1">&#39;std(LogQ)&#39;</span><span class="p">,</span>
  <span class="s1">&#39;&lt;Tot[O]+12&gt;&#39;</span><span class="p">,</span>
  <span class="s1">&#39;std(Tot[O]+12)&#39;</span><span class="p">,</span>
  <span class="s1">&#39;[NII]/[SII]+;[OIII]/Hb|LogQ</span><span class="si">{KDE}</span><span class="s1">&#39;</span><span class="p">,</span>
  <span class="s1">&#39;err([NII]/[SII]+;[OIII]/Hb|LogQ</span><span class="si">{KDE}</span><span class="s1">)&#39;</span><span class="p">,</span>
  <span class="s1">&#39;[NII]/[SII]+;[OIII]/Hb|Tot[O]+12</span><span class="si">{KDE}</span><span class="s1">&#39;</span><span class="p">,</span>
  <span class="s1">&#39;err([NII]/[SII]+;[OIII]/Hb|Tot[O]+12</span><span class="si">{KDE}</span><span class="s1">)&#39;</span><span class="p">,</span>
  <span class="s1">&#39;[NII]/[OII]+;[OIII]/[SII]+|LogQ</span><span class="si">{KDE}</span><span class="s1">&#39;</span><span class="p">,</span>
  <span class="s1">&#39;err([NII]/[OII]+;[OIII]/[SII]+|LogQ</span><span class="si">{KDE}</span><span class="s1">)&#39;</span><span class="p">,</span>
  <span class="s1">&#39;[NII]/[OII]+;[OIII]/[SII]+|Tot[O]+12</span><span class="si">{KDE}</span><span class="s1">&#39;</span><span class="p">,</span>
  <span class="s1">&#39;err([NII]/[OII]+;[OIII]/[SII]+|Tot[O]+12</span><span class="si">{KDE}</span><span class="s1">)&#39;</span><span class="p">,</span>
  <span class="s1">&#39;&lt;LogQ</span><span class="si">{KDE}</span><span class="s1">&gt;&#39;</span><span class="p">,</span>
  <span class="s1">&#39;err(LogQ</span><span class="si">{KDE}</span><span class="s1">)&#39;</span><span class="p">,</span>
  <span class="s1">&#39;&lt;Tot[O]+12</span><span class="si">{KDE}</span><span class="s1">&gt;&#39;</span><span class="p">,</span>
  <span class="s1">&#39;err(Tot[O]+12</span><span class="si">{KDE}</span><span class="s1">)&#39;</span><span class="p">,</span>
  <span class="s1">&#39;flag&#39;</span><span class="p">,</span>
  <span class="s1">&#39;rs_offgrid&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>The first line of the input file must contain the name of each column,
following the pyqz convention. The order itself does not matter, e.g.:</p>
<p><code class="docutils literal"><span class="pre">Id,[OII]+,std[OII]+,Hb,stdHb,[OIII],std[OIII],[OI],std[OI],Ha,stdHa,[NII],std[NII],[SII]+,std[SII]+</span></code></p>
<p>The <code class="docutils literal"><span class="pre">Id</span></code> (optional) can be used to add a tag (i.e. a string) to each
set of line fluxes. This tag will be used in the filenames of the
diagrams (if some are saved) and in the output <code class="docutils literal"><span class="pre">.csv</span></code> file as well.</p>
<p>Commented line begin with <code class="docutils literal"><span class="pre">#</span></code>, missing values are marked with <code class="docutils literal"><span class="pre">$$$</span></code>
(set with the <code class="docutils literal"><span class="pre">missing_values</span></code> keyword), and the decimal precision in
the output file is set with <code class="docutils literal"><span class="pre">decimals</span></code> (default=5).</p>
<p><strong>At this point, it must be stressed that ``pyqz.get_global_qz()`` can
only exploit a finite set of diagnostic grids, namely:</strong></p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">pyqz</span><span class="o">.</span><span class="n">diagnostics</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;[NII]/[OII]+;[OIII]/[SII]+&#39;</span><span class="p">,</span>
 <span class="s1">&#39;[NII]/[OII]+;[OIII]/[OII]+&#39;</span><span class="p">,</span>
 <span class="s1">&#39;[NII]/[SII]+;[NII]/Ha;[OIII]/Hb&#39;</span><span class="p">,</span>
 <span class="s1">&#39;[NII]/[SII]+;[OIII]/Hb&#39;</span><span class="p">,</span>
 <span class="s1">&#39;[OIII]4363/[OIII];[OIII]/[SII]+&#39;</span><span class="p">,</span>
 <span class="s1">&#39;[NII]/[SII]+;[OIII]/[OII]+&#39;</span><span class="p">,</span>
 <span class="s1">&#39;[NII]/[OII]+;[SII]+/Ha&#39;</span><span class="p">,</span>
 <span class="s1">&#39;[OIII]4363/[OIII];[SII]+/Ha&#39;</span><span class="p">,</span>
 <span class="s1">&#39;[OIII]4363/[OIII];[OIII]/[OII]+&#39;</span><span class="p">,</span>
 <span class="s1">&#39;[NII]/[SII]+;[OIII]/[SII]+&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>These specific diagnostic diagrams are chosen to be largely flat, i.e.
they are able to cleanly disentangle the influence of <code class="docutils literal"><span class="pre">LogQ</span></code> and
<code class="docutils literal"><span class="pre">Tot[O]+12</span></code>. One does not need to use all the grids together. For
example, if one knows that an [OII] line flux measurement is corrupted,
one ought to simply use the diagnostic grids that do not rely on this
line to derive the estimates of <code class="docutils literal"><span class="pre">LogQ</span></code> and <code class="docutils literal"><span class="pre">Tot[O]+12</span></code>.</p>
<p>Users can easily add new diagnostics to this list (defined inside
<code class="docutils literal"><span class="pre">pyqz_metadata.py</span></code>), but will do so at their own risk.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../pyqz_demo_advanced/pyqz_demo_advanced.html" class="btn btn-neutral float-right" title="Running pyqz II" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../installation.html" class="btn btn-neutral" title="Installing pyqz" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014-2016, Frédéric P.A. Vogt.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.8.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>